<%= cms_snippet_content('ccf', @cms_site).html_safe %>
  

<div class="container">
  <div style="width:60%;margin:0 auto 0 auto;" class="inner-lower">

    <div class="list-group">
      <% @uniq_shifts.each do |title| %>
	
	<% @shifts_by_title = @shifts.where(title: title) %>
	<% @title_vols = @shifts_by_title.pluck(:vols_needed).sum %>
	<% @times = @shifts_by_title.pluck(:time) %>
	<% @time_vols = @shifts_by_title.pluck(:vols_needed) %>	

	<% if @title_vols > 0 %>

	  <!-- ACTIVITY TITLE -->
	  <div id=<%= "activity#{title}" %> class="activity">

	    <a href="#" class="list-group-item">
	      <%= title %>
	      <!-- ACTIVITY NUMBER VOLUNTEERS NEEDED-->
	      <span class="badge-volunteer"><%= @title_vols %></span>
	    </a>

	  </div>


	  <div class="sub" style="display:none;">

	    <% @shifts_by_title.each do |shift| %>
	      <!-- ACTIVITY SHIFT -->
	      <a href="#" class="list-group-item-sub">
		<!-- ACTIVITY SHIFT TIME -->
		<%= shift.time %>
		<span class="badge">
		  <!-- ACTIVITY SHIFT NUMBER OF VOLUNTEERS NEEDED -->
		  <%= shift.vols_needed %>
		</span>
	      </a>

	      <% @instance = shift %>

	      <%= link_to "sign up for this shift", shift_path(@instance, { :user_ids => @instance.user_ids + [@user.id] }), :method => :put, :confirm => "Are you sure?" %>

	      <!-- i am executing my instance class method add_user_id from a controller -->
	      <%= form_for shift, :method => :put do |f| %>
		<%= f.hidden_field :user_ids, { :value => [@user.id] } %>
		<%= f.submit "sign up", class: "btn btn-primary" %>
	      <% end %>

	    <% end %>
	  </div>

	  
	<% end %>

      <% end %>
    </div>
  </div>

  <script>

   $('.activity').click(function(){
     // if the Shift title click is a faded shift
     if ( $(this).hasClass('faded')) {
       // do nothing
       $(this).toggleClass('');
     }
     else {
       // when Shift title is clicked
       $(this).next('.sub').toggle('slow');
       // show the shift info
       $(this).prevAll('.activity').toggleClass('faded');
       // fade the previous Shifts
       $(this).nextAll('.activity').toggle('slow');
       // hide the next Shifts
     }

     return false;
   });

  </script>
  
</div>


