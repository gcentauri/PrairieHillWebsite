<div class="container" >
  <div style="margin-top:25em;">
    <h2 class="hi-li"> Shifts</h2>
    <% if current_user.try(:admin?) %>
      <%= link_to 'New Shift', new_shift_path %>
      <br/>

      <p>
	Download:
	<%= link_to "Excel", shifts_path(format: "xls") %>
      </p>
    <% end %>

    <%# @activities.each do |a| %>
    <%# @shifts.each do |shift| %>
    <% @shifts_by_title = @shifts.pluck(:title).uniq %>
    <%# if @shifts_by_title.count > 0 %>

    <% @shifts_by_title.each do |s| %>
      <% @shift_match =  @shifts.where(title: s).order(:title) %>
      <table class="table">
	<h2>
	  <%= s %> (<%= @shift_match.count %> shifts)
	</h2>
	<tr>
	  <th>Time</th>
	  <th>Volunteer</th>
	  <th></th>
	  <th></th>
	  <th></th>
	</tr>

	<% @shift_match.each do |shift| %>
	  <tr>
	    <td><%= shift.time %></td>
	    <td>
	      <% if shift.guest != nil %>
		<%= shift.guest %>
	      <% else %>
		<%= shift.volunteer %>
	      <% end %>
	    </td>
	    <% if current_user.try(:admin?) %>
	      <td><%= link_to 'Show', shift %></td>
	      <td><%= link_to 'Edit', edit_shift_path(shift) %></td>
	      <td><%= link_to 'Destroy', shift, :method => :delete, :data => { :confirm => 'Are you sure?' } %></td>
	    <% end %>
	  </tr>
	<% end %>
      </table>	  
    <% end %>
  </div>
</div>
